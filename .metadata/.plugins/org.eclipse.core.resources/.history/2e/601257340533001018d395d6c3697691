package thw.edu.javaII.port.warehouse.ui.panels;

import thw.edu.javaII.port.warehouse.model.Bestellung;
import thw.edu.javaII.port.warehouse.model.BestellungProdukt;
import thw.edu.javaII.port.warehouse.ui.common.Session;

import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import java.awt.*;
import java.text.SimpleDateFormat;

public class BestellungDetailDialog extends JDialog {
    private final Session session;
    private final Bestellung bestellung;

    public BestellungDetailDialog(Frame parent, Session session, Bestellung bestellung) {
        super(parent, "Bestellungsdetails", true);
        this.session = session;
        this.bestellung = bestellung;
        setSize(600, 400);
        setLocationRelativeTo(parent);
        setLayout(new BorderLayout());
        initializeUI();
    }

    private void initializeUI() {
        // Kundeninformationen
        JPanel inputPanel = new JPanel(new GridLayout(4, 2, 5, 5));
        inputPanel.add(new JLabel("Bestell-ID:"));
        JTextField idField = new JTextField(String.valueOf(bestellung.getId()));
        idField.setEditable(false);
        inputPanel.add(idField);

        inputPanel.add(new JLabel("Kundenname:"));
        JTextField nameField = new JTextField(bestellung.getKunde() != null ? bestellung.getKunde().getName() : "Unbekannt");
        nameField.setEditable(false);
        inputPanel.add(nameField);

        inputPanel.add(new JLabel("Lieferadresse:"));
        JTextField lieferadresseField = new JTextField(bestellung.getKunde() != null ? bestellung.getKunde().getLieferadresse() : "Unbekannt");
        lieferadresseField.setEditable(false);
        inputPanel.add(lieferadresseField);

        inputPanel.add(new JLabel("Datum:"));
        SimpleDateFormat sdf = new SimpleDateFormat("dd.MM.yyyy HH:mm:ss");
        JTextField datumField = new JTextField(bestellung.getDatum() != null ? sdf.format(bestellung.getDatum()) : "Unbekannt");
        datumField.setEditable(false);
        inputPanel.add(datumField);

        add(inputPanel, BorderLayout.NORTH);

        // Produkt-Tabelle
        String[] columns = {"Produktname", "Anzahl"};
        DefaultTableModel tableModel = new DefaultTableModel(columns, 0);
        JTable table = new JTable(tableModel);
        table.setRowHeight(25);
        JScrollPane scrollPane = new JScrollPane(table);
        add(scrollPane, BorderLayout.CENTER);

        // Produkte laden
        for (BestellungProdukt bp : bestellung.getProdukte()) {
            tableModel.addRow(new Object[]{bp.getProdukt().getName(), bp.getAnzahl()});
        }

        // Schließen-Button
        JButton closeButton = new JButton("Schließen");
        closeButton.addActionListener(e -> dispose());
        JPanel buttonPanel = new JPanel();
        buttonPanel.add(closeButton);
        add(buttonPanel, BorderLayout.SOUTH);
    }
}